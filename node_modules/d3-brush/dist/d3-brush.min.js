// https://d3js.org/d3-brush/ v2.1.0 Copyright 2020 Mike Bostock
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],t):t((e=e||self).d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,r,i,s){"use strict";var u=e=>()=>e;function o(e,{sourceEvent:t,target:n,selection:r,mode:i,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function a(e){e.preventDefault(),e.stopImmediatePropagation()}var l={name:"drag"},c={name:"space"},h={name:"handle"},f={name:"center"};const{abs:d,max:p,min:b}=Math;function y(e){return[+e[0],+e[1]]}function v(e){return[y(e[0]),y(e[1])]}var m={name:"x",handles:["w","e"].map(E),input:function(e,t){return null==e?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},w={name:"y",handles:["n","s"].map(E),input:function(e,t){return null==e?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},g={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(E),input:function(e){return null==e?null:v(e)},output:function(e){return e}},_={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},x={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},k={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},z={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},A={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function E(e){return{type:e}}function q(e){return!e.ctrlKey&&!e.button}function K(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function P(){return navigator.maxTouchPoints||"ontouchstart"in this}function T(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function V(e){var y,g=K,V=q,j=P,M=!0,S=t.dispatch("start","brush","end"),B=6;function C(t){var n=t.property("__brush",Y).selectAll(".overlay").data([E("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",_.overlay).merge(n).each(function(){var e=T(this).extent;i.select(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])}),t.selectAll(".selection").data([E("selection")]).enter().append("rect").attr("class","selection").attr("cursor",_.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(e.handles,function(e){return e.type});r.exit().remove(),r.enter().append("rect").attr("class",function(e){return"handle handle--"+e.type}).attr("cursor",function(e){return _[e.type]}),t.each(D).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",G).filter(j).on("touchstart.brush",G).on("touchmove.brush",N).on("touchend.brush touchcancel.brush",X).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function D(){var e=i.select(this),t=T(this).selection;t?(e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(e){return"e"===e.type[e.type.length-1]?t[1][0]-B/2:t[0][0]-B/2}).attr("y",function(e){return"s"===e.type[0]?t[1][1]-B/2:t[0][1]-B/2}).attr("width",function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+B:B}).attr("height",function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+B:B})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function I(e,t,n){var r=e.__brush.emitter;return!r||n&&r.clean?new O(e,t,n):r}function O(e,t,n){this.that=e,this.args=t,this.state=e.__brush,this.active=0,this.clean=n}function G(t){if((!y||t.touches)&&V.apply(this,arguments)){var r,u,o,v,g,E,q,K,P,j,S,B=this,C=t.target.__data__.type,O="selection"===(M&&t.metaKey?C="overlay":C)?l:M&&t.altKey?f:h,G=e===w?null:z[C],N=e===m?null:A[C],X=T(B),Y=X.extent,F=X.selection,H=Y[0][0],J=Y[0][1],L=Y[1][0],Q=Y[1][1],R=0,U=0,W=G&&N&&M&&t.shiftKey,Z=Array.from(t.touches||[t],e=>{const t=e.identifier;return(e=i.pointer(e,B)).point0=e.slice(),e.identifier=t,e});if("overlay"===C){F&&(P=!0);const t=[Z[0],Z[1]||Z[0]];X.selection=F=[[r=e===w?H:b(t[0][0],t[1][0]),o=e===m?J:b(t[0][1],t[1][1])],[g=e===w?L:p(t[0][0],t[1][0]),q=e===m?Q:p(t[0][1],t[1][1])]],Z.length>1&&ie()}else r=F[0][0],o=F[0][1],g=F[1][0],q=F[1][1];u=r,v=o,E=g,K=q;var $=i.select(B).attr("pointer-events","none"),ee=$.selectAll(".overlay").attr("cursor",_[C]);s.interrupt(B);var te=I(B,arguments,!0).beforestart();if(t.touches)te.moved=re,te.ended=se;else{var ne=i.select(t.view).on("mousemove.brush",re,!0).on("mouseup.brush",se,!0);M&&ne.on("keydown.brush",function(e){switch(e.keyCode){case 16:W=G&&N;break;case 18:O===h&&(G&&(g=E-R*G,r=u+R*G),N&&(q=K-U*N,o=v+U*N),O=f,ie());break;case 32:O!==h&&O!==f||(G<0?g=E-R:G>0&&(r=u-R),N<0?q=K-U:N>0&&(o=v-U),O=c,ee.attr("cursor",_.selection),ie());break;default:return}a(e)},!0).on("keyup.brush",function(e){switch(e.keyCode){case 16:W&&(j=S=W=!1,ie());break;case 18:O===f&&(G<0?g=E:G>0&&(r=u),N<0?q=K:N>0&&(o=v),O=h,ie());break;case 32:O===c&&(e.altKey?(G&&(g=E-R*G,r=u+R*G),N&&(q=K-U*N,o=v+U*N),O=f):(G<0?g=E:G>0&&(r=u),N<0?q=K:N>0&&(o=v),O=h),ee.attr("cursor",_[C]),ie());break;default:return}a(e)},!0),n.dragDisable(t.view)}D.call(B),te.start(t,O.name)}function re(e){for(const t of e.changedTouches||[e])for(const e of Z)e.identifier===t.identifier&&(e.cur=i.pointer(t,B));if(W&&!j&&!S&&1===Z.length){const e=Z[0];d(e.cur[0]-e[0])>d(e.cur[1]-e[1])?S=!0:j=!0}for(const e of Z)e.cur&&(e[0]=e.cur[0],e[1]=e.cur[1]);P=!0,a(e),ie(e)}function ie(e){const t=Z[0],n=t.point0;var i;switch(R=t[0]-n[0],U=t[1]-n[1],O){case c:case l:G&&(R=p(H-r,b(L-g,R)),u=r+R,E=g+R),N&&(U=p(J-o,b(Q-q,U)),v=o+U,K=q+U);break;case h:Z[1]?(G&&(u=p(H,b(L,Z[0][0])),E=p(H,b(L,Z[1][0])),G=1),N&&(v=p(J,b(Q,Z[0][1])),K=p(J,b(Q,Z[1][1])),N=1)):(G<0?(R=p(H-r,b(L-r,R)),u=r+R,E=g):G>0&&(R=p(H-g,b(L-g,R)),u=r,E=g+R),N<0?(U=p(J-o,b(Q-o,U)),v=o+U,K=q):N>0&&(U=p(J-q,b(Q-q,U)),v=o,K=q+U));break;case f:G&&(u=p(H,b(L,r-R*G)),E=p(H,b(L,g+R*G))),N&&(v=p(J,b(Q,o-U*N)),K=p(J,b(Q,q+U*N)))}E<u&&(G*=-1,i=r,r=g,g=i,i=u,u=E,E=i,C in x&&ee.attr("cursor",_[C=x[C]])),K<v&&(N*=-1,i=o,o=q,q=i,i=v,v=K,K=i,C in k&&ee.attr("cursor",_[C=k[C]])),X.selection&&(F=X.selection),j&&(u=F[0][0],E=F[1][0]),S&&(v=F[0][1],K=F[1][1]),F[0][0]===u&&F[0][1]===v&&F[1][0]===E&&F[1][1]===K||(X.selection=[[u,v],[E,K]],D.call(B),te.brush(e,O.name))}function se(e){if(function(e){e.stopImmediatePropagation()}(e),e.touches){if(e.touches.length)return;y&&clearTimeout(y),y=setTimeout(function(){y=null},500)}else n.dragEnable(e.view,P),ne.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);$.attr("pointer-events","all"),ee.attr("cursor",_.overlay),X.selection&&(F=X.selection),function(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}(F)&&(X.selection=null,D.call(B)),te.end(e,O.name)}}function N(e){I(this,arguments).moved(e)}function X(e){I(this,arguments).ended(e)}function Y(){var t=this.__brush||{selection:null};return t.extent=v(g.apply(this,arguments)),t.dim=e,t}return C.move=function(t,n){t.tween?t.on("start.brush",function(e){I(this,arguments).beforestart().start(e)}).on("interrupt.brush end.brush",function(e){I(this,arguments).end(e)}).tween("brush",function(){var t=this,i=t.__brush,s=I(t,arguments),u=i.selection,o=e.input("function"==typeof n?n.apply(this,arguments):n,i.extent),a=r.interpolate(u,o);function l(e){i.selection=1===e&&null===o?null:a(e),D.call(t),s.brush()}return null!==u&&null!==o?l:l(1)}):t.each(function(){var t=this,r=arguments,i=t.__brush,u=e.input("function"==typeof n?n.apply(t,r):n,i.extent),o=I(t,r).beforestart();s.interrupt(t),i.selection=null===u?null:u,D.call(t),o.start().brush().end()})},C.clear=function(e){C.move(e,null)},O.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(e,t){return this.starting?(this.starting=!1,this.emit("start",e,t)):this.emit("brush",e),this},brush:function(e,t){return this.emit("brush",e,t),this},end:function(e,t){return 0==--this.active&&(delete this.state.emitter,this.emit("end",e,t)),this},emit:function(t,n,r){var s=i.select(this.that).datum();S.call(t,this.that,new o(t,{sourceEvent:n,target:C,selection:e.output(this.state.selection),mode:r,dispatch:S}),s)}},C.extent=function(e){return arguments.length?(g="function"==typeof e?e:u(v(e)),C):g},C.filter=function(e){return arguments.length?(V="function"==typeof e?e:u(!!e),C):V},C.touchable=function(e){return arguments.length?(j="function"==typeof e?e:u(!!e),C):j},C.handleSize=function(e){return arguments.length?(B=+e,C):B},C.keyModifiers=function(e){return arguments.length?(M=!!e,C):M},C.on=function(){var e=S.on.apply(S,arguments);return e===S?C:e},C}e.brush=function(){return V(g)},e.brushSelection=function(e){var t=e.__brush;return t?t.dim.output(t.selection):null},e.brushX=function(){return V(m)},e.brushY=function(){return V(w)},Object.defineProperty(e,"__esModule",{value:!0})});
